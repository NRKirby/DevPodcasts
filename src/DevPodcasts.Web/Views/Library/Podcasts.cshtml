@model DevPodcasts.Web.Features.Library.Index.List.ViewModel
@{
    ViewBag.Title = "Library";
    var userId = Model?.UserId ?? string.Empty;
}

<div class="library-container container">
    <h1>Library</h1>

    <ul class="nav nav-tabs" role="tablist">
        <li class="active"><a href="~/library/podcasts" role="tab">Podcasts</a></li>
        @*<li><a href="~/library/episodes" role="tab">Episodes</a></li>*@
    </ul>

    @if (Model?.SubscribedPodcasts != null)
    {
        <table>
            @foreach (var podcast in Model.SubscribedPodcasts)
            {
                <tr>
                    @Html.HiddenFor(m => podcast.Id)
                    <td class="remove-from-library"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></td>
                    <td class="podcast-title"><a href="~/podcasts/detail/@podcast.Id">@podcast.Title</a></td>
                    @*<td><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span></td>*@
                </tr>
            }
        </table>
    }

</div>

<script>
    $('.remove-from-library').on('click', function () {
        if (confirm('Are you sure you want to remove?')) {
                        
            //console.log($(this).parents('tr').children().find('.podcast-title > a').text());

            var thisTableRow = $(this).parents('tr');

            var p = $(this).parents('tr').find('input[type="hidden"]').val();
            var data = {
                u: '@userId',
                p: p
        }

            $.ajax({
                url: "/Podcasts/AddRemove",
                type: "POST",
                data: JSON.stringify(data),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function() {
                    $(thisTableRow).hide("slow");
                }
            });
        }
    })
</script>
